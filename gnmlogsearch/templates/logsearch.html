{% themeextends "base.html" %}

{% block head %}
<style>
    div.bordered {  border: 1px solid black;  }
    div.floatingpanel { float: left; padding: 0.5em; margin: 0.5em;  width: 25%; height: 33%; }
    div.scrollable { overflow-x: visible; overflow-y: scroll; max-height: 250px; margin-top: 0; }
    label.fieldlabel { display: block; float: none; }
</style>
{% endblock %}

{% block body %}

<div class="header">
    <h1>Search Vidispine Logs</h1>
</div>

{% if search_error %}
<p class="error">{{ search_error }}</p>
{% endif %}
{% if search_results %}
<a onclick="toggleSearchParams();" id="searchToggleButton" style="cursor: pointer;">show search...</a>
<div class="content" id="searchparams" style="display: none;">
{% else %}
<div class="content" id="searchparams">
{% endif %}
    <form method="POST" action="">
        {% csrf_token %}
        <div id="searchcontrols" style="display: block; overflow: hidden">
        <div class="floatingpanel">
            {{ search_form.type.errors }}
            <label class="fieldlabel" for="id_name">Job Type</label>
            <div class="scrollable">
            {{ search_form.type }}
            </div>
        </div>
        <div class="floatingpanel">
            {{ search_form.state.errors }}
            <label class="fieldlabel" for="id_name">Job State</label>
            <div class="scrollable">
            {{ search_form.state }}
            </div>
        </div>
        <div class="floatingpanel">
            {{ search_form.sort.errors }}
            <label class="fieldlabel" for="id_name">Sort By</label>
            {{ search_form.sort }}
            <label class="fieldlabel" for="id_sortOrder"></label>
            {{ search_form.sortOrder.errors }}
            {{ search_form.sortOrder }}
        </div>
        <div class="floatingpanel">
            {{ search_form.fileNameContains.errors }}
            <label class="fieldlabel" for="id_name">Filename contains</label>
            {{ search_form.fileNameContains }}
        </div>
        <div class="floatingpanel">
            {{ search_form.jobmetadata.errors }}
            <label class="fieldlabel" for="id_name">Metadata search (advanced)</label>
            {{ search_form.jobmetadata }}
        </div>
        </div>
        <div id="buttons" style="display: block; padding: 0.5em; margin: 0.5em;">
            <input type="submit" value="Search">
            <input type="reset" value="Clear">
        </div>
    </form>
</div>

{% if search_hits %}
<p class="info">Your search returned {{ search_hits }} result{{ search_hits|pluralize }}</p>
{% endif %}
{% if search_results %}
<div class="content" style="overflow: scroll;" id="searchresults">
    <table class="details">
<!--        <tr class="header">
            {% for k,v in search_results.0.items %}
            <td>{{ k }}</td>
            {% endfor %}
        </tr>
        {% for row in search_results %}
        <tr class="{% cycle odd even %}">
            {% for k,v in row.items %}
            <td>{{ v }}</td>
            {% endfor %}
        </tr>
        {% endfor %}
-->
        <tr class="header">
            <td id="col_jobId">jobId</td>
            <td id="col_status">status</td>
            <td id="col_type">type</td>
            <td id="col_started">started</td>
            <td id="col_priority">priority</td>
            <td id="col_systemJobModule">systemJobModule</td>
            <td id="col_systemJobInfo">systemJobInfo</td>
            <td id="col_bestEffortFilename">bestEffortFilename</td>
            <td id="col_fileId">fileId</td>
            <td id="col_replicatedFileIds">replicatedFileIds</td>
            <td id="col_fileDeleted">fileDeleted</td>
            <td id="col_fileStateOnFailure">fileStateOnFailure</td>
            <td id="col_filePathMap">filePathMap</td>
            <td id="col_replicatedFileInfo">replicatedFileInfo</td>
            <td id="col_checkReplicatedFiles">checkReplicatedFiles</td>
        </tr>

        {% for row in search_results %}
        <tr class="{% cycle odd even %}">
            <td>{{ row.jobId }}</td>
            <td>{{ row.status }}</td>
            <td>{{ row.type }}</td>
            <td>{{ row.started }}</td>
            <td>{{ row.priority }}</td>
            <td>{{ row.systemJobModule }}</td>
            <td>{{ row.systemJobInfo }}</td>
            <td>{{ row.bestEffortFilename }}</td>
            <td>{{ row.fileId }}</td>
            <td>{{ row.replicatedFileIds }}</td>
            <td>{{ row.fileDeleted }}</td>
            <td>{{ row.fileStateOnFailure }}</td>
            <td>{{ row.filePathMap }}</td>
            <td>{{ row.replicatedFileInfo }}</td>
            <td>{{ row.checkReplicatedFiles }}</td>
        </tr>
        {% endfor %}
    </table>
</div>
{% endif %}

<script>
    var showSearch=false;
    function toggleSearchParams()
    {
        if(showSearch==false){
            showSearch=true;
            //$('#searchparams').removeClass('invisible');
            $('#searchparams').fadeIn();
            $('#searchToggleButton').html('hide search...');
        } else {
            showSearch=false;
            //$('#searchparams').addClass('invisible');
            $('#searchparams').fadeOut();
            $('#searchToggleButton').html('show search...');
        }
    }
    $(document).ready(function(){

    });
</script>
{% endblock %}